<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سایت آزمون تستی - موسسه آموزشی دکتر علی هاشمی</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #1a6fc4, #1a237e);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .institute-name {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .exam-title {
            font-size: 2rem;
            margin: 20px 0;
            color: #1a237e;
        }
        .subject-label {
            font-weight: bold;
            margin-top: 20px;
            color: #1a6fc4;
            border-bottom: 2px solid #1a6fc4;
            padding-bottom: 5px;
        }
        .question-container {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .question-container:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .question-number {
            font-weight: bold;
            color: #1a237e;
            margin-left: 5px;
        }
        .option-btn {
            width: 40px;
            height: 40px;
            margin: 5px;
            border-radius: 50%;
            font-weight: bold;
        }
        .btn-selected {
            background-color: #1a6fc4;
            color: white;
        }
        .timer-container {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .timer-display {
            font-size: 2rem;
            font-weight: bold;
            color: #1a237e;
        }
        .timer-warning {
            color: #dc3545;
        }
        .results-panel {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        .percentage {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1a237e;
        }
        .stats {
            font-size: 1.1rem;
        }
        .admin-panel {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #dee2e6;
        }
        .sticky-top {
            position: sticky;
            top: 20px;
            z-index: 100;
        }
        .subject-row {
            margin-bottom: 30px;
        }
        .subject-result {
            background-color: #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        .subject-percentage {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .negative-percentage {
            color: #dc3545;
        }
        .exam-finished {
            opacity: 0.7;
            pointer-events: none;
        }
        @media (max-width: 768px) {
            .option-btn {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="header text-center mb-4">
        <div class="container">
            <h1 class="institute-name">موسسه آموزشی دکتر علی هاشمی</h1>
            <p class="mb-0">سامانه آزمون های تستی هفتگی</p>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <h2 class="exam-title text-center">آزمون هفتگی</h2>
                
                <div class="timer-container">
                    <h4>زمان باقیمانده</h4>
                    <div class="timer-display" id="timer">01:00:00</div>
                    <p id="current-subject">زیست شناسی (سوالات ۱ تا ۳۰)</p>
                </div>
                
                <div class="text-center mb-4">
                    <button id="startBtn" class="btn btn-success me-2"><i class="bi bi-play-circle"></i> شروع آزمون</button>
                    <button id="resetBtn" class="btn btn-outline-danger me-2" disabled><i class="bi bi-arrow-clockwise"></i> ریست پاسخها</button>
                    <button id="submitBtn" class="btn btn-success" disabled><i class="bi bi-check-circle"></i> محاسبه نمره</button>
                </div>
                
                <div id="exam-content">
                    <div class="subject-row">
                        <h4 class="subject-label">زیست شناسی (سوالات ۱ تا ۳۰)</h4>
                        <div class="row" id="biology-questions">
                            <!-- Biology questions will be generated here -->
                        </div>
                    </div>
                    
                    <div class="subject-row">
                        <h4 class="subject-label">فیزیک (سوالات ۳۱ تا ۴۰)</h4>
                        <div class="row" id="physics-questions">
                            <!-- Physics questions will be generated here -->
                        </div>
                    </div>
                    
                    <div class="subject-row">
                        <h4 class="subject-label">شیمی (سوالات ۴۱ تا ۵۰)</h4>
                        <div class="row" id="chemistry-questions">
                            <!-- Chemistry questions will be generated here -->
                        </div>
                    </div>
                    
                    <div class="subject-row">
                        <h4 class="subject-label">ریاضی (سوالات ۵۱ تا ۶۰)</h4>
                        <div class="row" id="math-questions">
                            <!-- Math questions will be generated here -->
                        </div>
                    </div>
                    
                    <div class="text-center mt-4 mb-5">
                        <button id="submitBtn2" class="btn btn-success btn-lg" disabled><i class="bi bi-check-circle"></i> محاسبه نمره نهایی</button>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="sticky-top">
                    <div class="results-panel text-center">
                        <h4>نتایج آزمون</h4>
                        <div class="percentage" id="percentage">0%</div>
                        <div class="stats mt-3">
                            <p>تعداد صحیح: <span id="correctCount">0</span></p>
                            <p>تعداد غلط: <span id="wrongCount">0</span></p>
                            <p>بی پاسخ: <span id="unansweredCount">60</span></p>
                        </div>
                        
                        <div id="subjectResults" class="mt-4">
                            <h5>نتایج دروس</h5>
                            <div class="subject-result">
                                <div>زیست شناسی</div>
                                <div class="subject-percentage" id="biology-percentage">0%</div>
                            </div>
                            <div class="subject-result">
                                <div>فیزیک</div>
                                <div class="subject-percentage" id="physics-percentage">0%</div>
                            </div>
                            <div class="subject-result">
                                <div>شیمی</div>
                                <div class="subject-percentage" id="chemistry-percentage">0%</div>
                            </div>
                            <div class="subject-result">
                                <div>ریاضی</div>
                                <div class="subject-percentage" id="math-percentage">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-panel mt-4">
                        <h5 class="text-center">پنل مدیریت</h5>
                        <div class="mb-3">
                            <label for="adminKey" class="form-label">کلید مدیریت:</label>
                            <input type="password" class="form-control" id="adminKey" placeholder="برای دسترسی وارد شوید">
                        </div>
                        <button id="adminBtn" class="btn btn-outline-primary w-100">ورود به پنل</button>
                        
                        <div id="adminSection" class="mt-3 d-none">
                            <h6>تعیین پاسخ های صحیح:</h6>
                            <div id="correctAnswersContainer" class="mb-3">
                                <!-- Correct answers inputs will be here -->
                            </div>
                            <button id="saveAnswersBtn" class="btn btn-success w-100">ذخیره پاسخ های صحیح</button>
                            <button id="viewResultsBtn" class="btn btn-info w-100 mt-2">مشاهده نتایج دانش آموزان</button>
                            
                            <div id="studentsResults" class="mt-3 d-none">
                                <h6>نتایج دانش آموزان:</h6>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-sm">
                                        <thead>
                                            <tr>
                                                <th>ردیف</th>
                                                <th>نام دانش آموز</th>
                                                <th>درصد کل</th>
                                                <th>زیست</th>
                                                <th>فیزیک</th>
                                                <th>شیمی</th>
                                                <th>ریاضی</th>
                                            </tr>
                                        </thead>
                                        <tbody id="resultsTableBody">
                                            <!-- Results will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <p>تمامی حقوق برای موسسه آموزشی دکتر علی هاشمی محفوظ است © ۱۴۰۳</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize questions
            initializeQuestions();
            
            // Load saved answers if available
            loadSavedAnswers();
            
            // Set up event listeners
            document.getElementById('startBtn').addEventListener('click', startExam);
            document.getElementById('submitBtn').addEventListener('click', calculateScore);
            document.getElementById('submitBtn2').addEventListener('click', calculateScore);
            document.getElementById('resetBtn').addEventListener('click', resetAnswers);
            document.getElementById('adminBtn').addEventListener('click', toggleAdminPanel);
            document.getElementById('saveAnswersBtn').addEventListener('click', saveCorrectAnswers);
            document.getElementById('viewResultsBtn').addEventListener('click', toggleStudentsResults);
            
            // Initialize correct answers in admin panel
            initializeCorrectAnswers();
            
            // Disable exam content initially
            document.getElementById('exam-content').classList.add('exam-finished');
        });

        // Timer variables
        let timerInterval;
        let totalSeconds = 0;
        let examStarted = false;

        // Start the exam
        function startExam() {
            if (!examStarted) {
                examStarted = true;
                document.getElementById('startBtn').disabled = true;
                document.getElementById('resetBtn').disabled = false;
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn2').disabled = false;
                document.getElementById('exam-content').classList.remove('exam-finished');
                
                // Calculate total time based on subject times
                // زیست: 30 سوال × 60 ثانیه = 1800 ثانیه
                // فیزیک: 10 سوال × 90 ثانیه = 900 ثانیه
                // شیمی: 10 سوال × 60 ثانیه = 600 ثانیه
                // ریاضی: 10 سوال × 100 ثانیه = 1000 ثانیه
                totalSeconds = 1800 + 900 + 600 + 1000;
                
                startTimer();
            }
        }

        // Start the countdown timer
        function startTimer() {
            clearInterval(timerInterval);
            
            timerInterval = setInterval(function() {
                if (totalSeconds <= 0) {
                    clearInterval(timerInterval);
                    finishExam();
                    return;
                }
                
                totalSeconds--;
                updateTimerDisplay();
                
                // Update current subject based on remaining time
                updateCurrentSubject();
            }, 1000);
            
            updateTimerDisplay();
        }

        // Update timer display
        function updateTimerDisplay() {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            const timerDisplay = document.getElementById('timer');
            timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (totalSeconds < 300) { // Less than 5 minutes
                timerDisplay.classList.add('timer-warning');
            } else {
                timerDisplay.classList.remove('timer-warning');
            }
        }

        // Update current subject based on remaining time
        function updateCurrentSubject() {
            const subjectElement = document.getElementById('current-subject');
            
            if (totalSeconds > 3300) { // زیست: 1800 + 900 + 600 = 3300
                subjectElement.textContent = "زیست شناسی (سوالات ۱ تا ۳۰)";
            } else if (totalSeconds > 2400) { // فیزیک: 900 + 600 = 1500 -> 3300-1500=1800
                subjectElement.textContent = "فیزیک (سوالات ۳۱ تا ۴۰)";
            } else if (totalSeconds > 1800) { // شیمی: 600 -> 2400-600=1800
                subjectElement.textContent = "شیمی (سوالات ۴۱ تا ۵۰)";
            } else {
                subjectElement.textContent = "ریاضی (سوالات ۵۱ تا ۶۰)";
            }
        }

        // Finish the exam when time is up
        function finishExam() {
            examStarted = false;
            document.getElementById('exam-content').classList.add('exam-finished');
            alert("زمان آزمون به پایان رسید. پاسخ‌های شما ثبت شد.");
            calculateScore();
        }

        // Initialize all questions
        function initializeQuestions() {
            initializeSubjectQuestions('biology', 1, 30);
            initializeSubjectQuestions('physics', 31, 40);
            initializeSubjectQuestions('chemistry', 41, 50);
            initializeSubjectQuestions('math', 51, 60);
        }

        // Initialize questions for a subject
        function initializeSubjectQuestions(subject, start, end) {
            const container = document.getElementById(`${subject}-questions`);
            
            for (let i = start; i <= end; i++) {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'col-md-6 col-lg-4 mb-3';
                questionDiv.innerHTML = `
                    <div class="question-container">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>سوال <span class="question-number">${i}</span></span>
                            <button class="btn btn-sm btn-outline-secondary btn-no-answer" data-question="${i}">بی‌پاسخ</button>
                        </div>
                        <div class="d-flex justify-content-center">
                            <button class="btn btn-outline-primary option-btn" data-question="${i}" data-option="1">۱</button>
                            <button class="btn btn-outline-primary option-btn" data-question="${i}" data-option="2">۲</button>
                            <button class="btn btn-outline-primary option-btn" data-question="${i}" data-option="3">۳</button>
                            <button class="btn btn-outline-primary option-btn" data-question="${i}" data-option="4">۴</button>
                        </div>
                    </div>
                `;
                container.appendChild(questionDiv);
            }
            
            // Add event listeners to option buttons
            const optionButtons = container.querySelectorAll('.option-btn');
            optionButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!examStarted) return;
                    const questionNum = this.getAttribute('data-question');
                    const option = this.getAttribute('data-option');
                    selectOption(questionNum, option);
                });
            });
            
            // Add event listeners to no-answer buttons
            const noAnswerButtons = container.querySelectorAll('.btn-no-answer');
            noAnswerButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!examStarted) return;
                    const questionNum = this.getAttribute('data-question');
                    selectOption(questionNum, 0);
                });
            });
        }

        // Initialize correct answers inputs in admin panel
        function initializeCorrectAnswers() {
            const container = document.getElementById('correctAnswersContainer');
            
            for (let i = 1; i <= 60; i++) {
                const subject = getSubjectByQuestionNumber(i);
                const answerDiv = document.createElement('div');
                answerDiv.className = 'mb-2';
                answerDiv.innerHTML = `
                    <label for="correctAnswer${i}" class="form-label">سوال ${i} (${subject}):</label>
                    <select class="form-select form-select-sm" id="correctAnswer${i}">
                        <option value="0">بی‌پاسخ</option>
                        <option value="1">گزینه ۱</option>
                        <option value="2">گزینه ۲</option>
                        <option value="3">گزینه ۳</option>
                        <option value="4">گزینه ４</option>
                    </select>
                `;
                container.appendChild(answerDiv);
            }
            
            // Load saved correct answers if available
            loadCorrectAnswers();
        }

        // Get subject by question number
        function getSubjectByQuestionNumber(num) {
            if (num <= 30) return 'زیست';
            if (num <= 40) return 'فیزیک';
            if (num <= 50) return 'شیمی';
            return 'ریاضی';
        }

        // Select an option for a question
        function selectOption(questionNum, option) {
            // Reset all options for this question
            const allOptions = document.querySelectorAll(`.option-btn[data-question="${questionNum}"]`);
            allOptions.forEach(btn => {
                btn.classList.remove('btn-selected');
                btn.classList.add('btn-outline-primary');
            });
            
            // If option is 0 (no answer), just return
            if (option == 0) {
                // Save to localStorage
                saveAnswer(questionNum, 0);
                updateStats();
                return;
            }
            
            // Select the chosen option
            const selectedOption = document.querySelector(`.option-btn[data-question="${questionNum}"][data-option="${option}"]`);
            selectedOption.classList.remove('btn-outline-primary');
            selectedOption.classList.add('btn-selected');
            
            // Save to localStorage
            saveAnswer(questionNum, option);
            updateStats();
        }

        // Save answer to localStorage
        function saveAnswer(questionNum, answer) {
            let answers = JSON.parse(localStorage.getItem('studentAnswers')) || {};
            answers[questionNum] = answer;
            localStorage.setItem('studentAnswers', JSON.stringify(answers));
        }

        // Load saved answers from localStorage
        function loadSavedAnswers() {
            const answers = JSON.parse(localStorage.getItem('studentAnswers')) || {};
            
            for (const questionNum in answers) {
                const answer = answers[questionNum];
                if (answer == 0) {
                    // No answer
                    const noAnswerBtn = document.querySelector(`.btn-no-answer[data-question="${questionNum}"]`);
                    if (noAnswerBtn) {
                        noAnswerBtn.classList.add('btn-warning');
                    }
                } else {
                    // Selected option
                    const optionBtn = document.querySelector(`.option-btn[data-question="${questionNum}"][data-option="${answer}"]`);
                    if (optionBtn) {
                        optionBtn.classList.remove('btn-outline-primary');
                        optionBtn.classList.add('btn-selected');
                    }
                }
            }
            
            updateStats();
        }

        // Load correct answers from localStorage
        function loadCorrectAnswers() {
            const correctAnswers = JSON.parse(localStorage.getItem('correctAnswers')) || {};
            
            for (let i = 1; i <= 60; i++) {
                if (correctAnswers[i]) {
                    document.getElementById(`correctAnswer${i}`).value = correctAnswers[i];
                }
            }
        }

        // Save correct answers to localStorage
        function saveCorrectAnswers() {
            const correctAnswers = {};
            
            for (let i = 1; i <= 60; i++) {
                const answer = document.getElementById(`correctAnswer${i}`).value;
                correctAnswers[i] = parseInt(answer);
            }
            
            localStorage.setItem('correctAnswers', JSON.stringify(correctAnswers));
            alert('پاسخ‌های صحیح با موفقیت ذخیره شدند.');
        }

        // Calculate the score based on answers
        function calculateScore() {
            const studentAnswers = JSON.parse(localStorage.getItem('studentAnswers')) || {};
            const correctAnswers = JSON.parse(localStorage.getItem('correctAnswers')) || {};
            
            let correctCount = 0;
            let wrongCount = 0;
            let unansweredCount = 0;
            
            // Subject-specific counts
            let biologyCorrect = 0, biologyWrong = 0, biologyUnanswered = 0;
            let physicsCorrect = 0, physicsWrong = 0, physicsUnanswered = 0;
            let chemistryCorrect = 0, chemistryWrong = 0, chemistryUnanswered = 0;
            let mathCorrect = 0, mathWrong = 0, mathUnanswered = 0;
            
            // Check if correct answers are set
            if (Object.keys(correctAnswers).length === 0) {
                alert('لطفاً ابتدا پاسخ‌های صحیح را از طریق پنل مدیریت設定 کنید.');
                return;
            }
            
            // Calculate scores
            for (let i = 1; i <= 60; i++) {
                if (!studentAnswers[i] || studentAnswers[i] == 0) {
                    unansweredCount++;
                    
                    // Count by subject
                    if (i <= 30) biologyUnanswered++;
                    else if (i <= 40) physicsUnanswered++;
                    else if (i <= 50) chemistryUnanswered++;
                    else mathUnanswered++;
                } else if (studentAnswers[i] == correctAnswers[i]) {
                    correctCount++;
                    
                    // Count by subject
                    if (i <= 30) biologyCorrect++;
                    else if (i <= 40) physicsCorrect++;
                    else if (i <= 50) chemistryCorrect++;
                    else mathCorrect++;
                } else {
                    wrongCount++;
                    
                    // Count by subject
                    if (i <= 30) biologyWrong++;
                    else if (i <= 40) physicsWrong++;
                    else if (i <= 50) chemistryWrong++;
                    else mathWrong++;
                }
            }
            
            // Apply negative scoring formula: (3*correct - wrong) / (3*total) * 100
            const totalQuestions = 60;
            const score = (3 * correctCount - wrongCount) / (3 * totalQuestions) * 100;
            const finalPercentage = Math.max(0, score).toFixed(2);
            
            // Calculate subject percentages
            const biologyPercentage = calculateSubjectPercentage(biologyCorrect, biologyWrong, 30);
            const physicsPercentage = calculateSubjectPercentage(physicsCorrect, physicsWrong, 10);
            const chemistryPercentage = calculateSubjectPercentage(chemistryCorrect, chemistryWrong, 10);
            const mathPercentage = calculateSubjectPercentage(mathCorrect, mathWrong, 10);
            
            // Display results
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('unansweredCount').textContent = unansweredCount;
            document.getElementById('percentage').textContent = `${finalPercentage}%`;
            
            // Display subject results
            document.getElementById('biology-percentage').textContent = `${biologyPercentage}%`;
            document.getElementById('physics-percentage').textContent = `${physicsPercentage}%`;
            document.getElementById('chemistry-percentage').textContent = `${chemistryPercentage}%`;
            document.getElementById('math-percentage').textContent = `${mathPercentage}%`;
            
            // Apply negative percentage styling
            applyNegativePercentageStyle('biology-percentage', biologyPercentage);
            applyNegativePercentageStyle('physics-percentage', physicsPercentage);
            applyNegativePercentageStyle('chemistry-percentage', chemistryPercentage);
            applyNegativePercentageStyle('math-percentage', mathPercentage);
            
            // Save student result
            saveStudentResult(finalPercentage, biologyPercentage, physicsPercentage, chemistryPercentage, mathPercentage);
            
            // Stop the exam after calculation
            if (examStarted) {
                clearInterval(timerInterval);
                document.getElementById('exam-content').classList.add('exam-finished');
                examStarted = false;
            }
        }

        // Calculate percentage for a subject
        function calculateSubjectPercentage(correct, wrong, total) {
            const score = (3 * correct - wrong) / (3 * total) * 100;
            return Math.max(-20, score).toFixed(2); // Ensure minimum of -20%
        }

        // Apply negative percentage styling
        function applyNegativePercentageStyle(elementId, percentage) {
            const element = document.getElementById(elementId);
            if (parseFloat(percentage) < 0) {
                element.classList.add('negative-percentage');
            } else {
                element.classList.remove('negative-percentage');
            }
        }

        // Save student result to localStorage
        function saveStudentResult(percentage, biology, physics, chemistry, math) {
            // In a real application, you would have student identification
            // For this demo, we'll use a generic student name
            const studentName = prompt('لطفاً نام خود را وارد کنید:', 'دانش‌آموز');
            if (!studentName) return;
            
            let results = JSON.parse(localStorage.getItem('studentResults')) || [];
            results.push({
                name: studentName,
                percentage: percentage,
                biology: biology,
                physics: physics,
                chemistry: chemistry,
                math: math,
                timestamp: new Date().toLocaleString('fa-IR')
            });
            
            localStorage.setItem('studentResults', JSON.stringify(results));
        }

        // Update statistics
        function updateStats() {
            const answers = JSON.parse(localStorage.getItem('studentAnswers')) || {};
            
            let answeredCount = 0;
            for (const questionNum in answers) {
                if (answers[questionNum] != 0) {
                    answeredCount++;
                }
            }
            
            document.getElementById('unansweredCount').textContent = 60 - answeredCount;
        }

        // Reset all answers
        function resetAnswers() {
            if (confirm('آیا از ریست تمام پاسخ‌ها اطمینان دارید؟')) {
                localStorage.removeItem('studentAnswers');
                
                // Reset UI
                const optionButtons = document.querySelectorAll('.option-btn');
                optionButtons.forEach(btn => {
                    btn.classList.remove('btn-selected');
                    btn.classList.add('btn-outline-primary');
                });
                
                const noAnswerButtons = document.querySelectorAll('.btn-no-answer');
                noAnswerButtons.forEach(btn => {
                    btn.classList.remove('btn-warning');
                });
                
                document.getElementById('correctCount').textContent = '0';
                document.getElementById('wrongCount').textContent = '0';
                document.getElementById('unansweredCount').textContent = '60';
                document.getElementById('percentage').textContent = '0%';
                
                document.getElementById('biology-percentage').textContent = '0%';
                document.getElementById('physics-percentage').textContent = '0%';
                document.getElementById('chemistry-percentage').textContent = '0%';
                document.getElementById('math-percentage').textContent = '0%';
                
                // Remove negative percentage styling
                document.getElementById('biology-percentage').classList.remove('negative-percentage');
                document.getElementById('physics-percentage').classList.remove('negative-percentage');
                document.getElementById('chemistry-percentage').classList.remove('negative-percentage');
                document.getElementById('math-percentage').classList.remove('negative-percentage');
            }
        }

        // Toggle admin panel
        function toggleAdminPanel() {
            const adminKey = document.getElementById('adminKey').value;
            if (adminKey === 'admin123') { // Default admin password
                document.getElementById('adminSection').classList.toggle('d-none');
            } else {
                alert('کلید مدیریت صحیح نیست.');
            }
        }

        // Toggle students results
        function toggleStudentsResults() {
            const resultsSection = document.getElementById('studentsResults');
            resultsSection.classList.toggle('d-none');
            
            if (!resultsSection.classList.contains('d-none')) {
                displayStudentsResults();
            }
        }

        // Display students results
        function displayStudentsResults() {
            const results = JSON.parse(localStorage.getItem('studentResults')) || [];
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '';
            
            if (results.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="text-center">نتیجه‌ای یافت نشد</td></tr>';
                return;
            }
            
            results.forEach((result, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${result.name}</td>
                    <td>${result.percentage}%</td>
                    <td>${result.biology}%</td>
                    <td>${result.physics}%</td>
                    <td>${result.chemistry}%</td>
                    <td>${result.math}%</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>